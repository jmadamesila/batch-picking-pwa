<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<title>Batch Picking Report ‚Äî $date</title>
<style>
:root { --row-h: 50px; --left-w: 90px; --timebar-h: 22px; --pad: 8px; --timeline-w: ${base_width}px; --hdr: 56px;
  --bg:#0b1220; --panel:#0b1220; --fg:#e5e7eb; --muted:#9aa4b2; --grid:rgba(255,255,255,0.10); --bar-border:rgba(255,255,255,0.24);
  --accent:#38bdf8; --card:#0e1a2b; --name-fg:#f1f5f9; --legend-bg: rgba(0,0,0,0.55); --legend-fg:#ffffff; }
body.light{ --bg:#ffffff; --panel:#ffffff; --fg:#0f172a; --muted:#6b7280; --grid: rgba(0,0,0,0.08); --bar-border: rgba(0,0,0,0.30); --accent:#0ea5e9; --card:#f7fafc; --name-fg:#0b1220; --legend-bg: rgba(255,255,255,0.92); --legend-fg:#0f172a; }
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:12px/1.26 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.top{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--grid);padding:8px 10px;z-index:4000}
.top h1{margin:0 0 6px 0;font-size:18px}
.ctrl{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.btn{appearance:none;border:1px solid var(--grid);background:var(--panel);color:var(--fg);padding:4px 8px;border-radius:8px;cursor:pointer}
.range{accent-color:var(--accent);width:clamp(110px,24vw,220px)}
.viewport{height:calc(100vh - var(--hdr,56px))}
.scroll{height:100%;overflow:hidden;background:var(--panel)}
#hs{overflow:auto;-webkit-overflow-scrolling:touch;background:var(--panel);height:100%}
.table{position:relative;min-width:calc(var(--left-w) + 300px);background:var(--panel)}
.headerRow{display:grid;grid-template-columns:var(--left-w) 1fr;position:sticky;top:0;z-index:20;background:var(--panel);border-bottom:1px solid var(--grid)}
.footerRow{display:grid;grid-template-columns:var(--left-w) 1fr;position:sticky;bottom:0;z-index:20;background:var(--panel);border-top:1px solid var(--grid)}
.leftHead{height:var(--timebar-h);background:var(--panel);box-sizing:border-box}
.timebar{height:var(--timebar-h);position:relative;background:var(--panel)}
.ticks{position:relative;width:var(--timeline-w);height:100%;background:var(--panel)}
.tick{position:absolute;top:0;transform:translateX(-50%);font-size:11px;color:var(--muted)}
.tick::after{content:"";position:absolute;left:50%;top:14px;width:1px;height:10px;background:var(--grid)}
.leftDivider{position:absolute;left:var(--left-w);top:0;bottom:0;width:1px;background:var(--grid);z-index:5;pointer-events:none}
.body{display:block;width:calc(var(--left-w) + var(--timeline-w));background:var(--panel)}
.row{display:flex}
.cell{min-height:var(--row-h)}
.left{position:sticky;left:0;z-index:1000;background:var(--panel);display:flex;flex-direction:column;justify-content:center;padding:6px var(--pad);flex:0 0 var(--left-w);box-sizing:border-box;border-bottom:1px solid var(--grid)}
.right{position:relative;overflow:visible;z-index:1;flex:1 1 auto}
.track{position:relative;width:var(--timeline-w);height:var(--row-h);background:var(--card);border-top:1px solid var(--grid);border-bottom:1px solid var(--grid);background-clip:padding-box}
.vline{position:absolute;top:0;bottom:0;width:1px;background:var(--grid)}
.emp-name{font-weight:800;color:var(--name-fg);font-size:12.5px}
.emp-stats{color:var(--muted);display:grid;row-gap:2px;font-size:10px}
.bar{position:absolute;top:6px;height:calc(var(--row-h) - 12px);border:1px solid var(--bar-border);border-radius:8px;color:#fff;font-size:9.5px;display:flex;align-items:center;justify-content:center;padding:0 6px;box-shadow:0 2px 6px rgba(0,0,0,0.18);cursor:pointer}
.bar-text{text-align:center;line-height:1.05;pointer-events:none;white-space:nowrap}
#tip{position:fixed;z-index:100000;max-width:280px;background:#111;color:#fff;padding:10px 12px;border-radius:10px;font-size:12px;line-height:1.25;box-shadow:0 6px 20px rgba(0,0,0,0.18);display:none;pointer-events:none}
#tip.above:after{content:"";position:absolute;width:12px;height:12px;background:#111;transform:rotate(45deg);left:16px;bottom:-6px}
#tip.below:after{content:"";position:absolute;width:12px;height:12px;background:#111;transform:rotate(45deg);left:16px;top:-6px}
.legend {position:fixed;right:12px;bottom:12px;z-index:2000;background:var(--legend-bg);color:var(--legend-fg);padding:10px 12px 40px 12px;border-radius:10px;backdrop-filter:blur(6px);font-size:11px;line-height:1.3;box-shadow:0 8px 24px rgba(0,0,0,0.18)}
.legend .row{display:flex;align-items:center;gap:8px}
.sw{width:14px;height:10px;border:2px solid transparent;border-radius:4px;display:inline-block}
.lg{display:grid;gap:6px}
.legBtn{position:absolute;right:8px;bottom:8px;width:28px;height:28px;border-radius:50%;border:1px solid var(--grid);background:var(--panel);color:var(--fg);box-shadow:0 4px 12px rgba(0,0,0,0.18);cursor:pointer}
.legend.min{padding:6px}
.legend.min .lg{display:none}
</style>
</head>
<body>
<header class="top">
  <h1>Batch Picking Report ‚Äî $date</h1>
  <div class="ctrl">
    <button id="themeBtn" class="btn" title="Toggle theme">‚òÄÔ∏è</button>
    <label class="btn" style="display:flex;align-items:center;gap:6px">Sort
      <select id="sortSelect" class="btn" style="padding:4px 8px">
        <option value="start">Start time</option>
        <option value="name">Name</option>
        <option value="uph">UPH</option>
        <option value="runs">Runs</option>
      </select>
    </label>
    <button id="zoomOut" class="btn">‚àí</button>
    <input id="zoomRange" class="range" type="range" min="0.5" max="3" step="0.05" value="0.5">
    <button id="zoomIn" class="btn">+</button>
  </div>
  
</header>
<div class="viewport">
  <div class="scroll">
    <div id="hs" class="table">
      <div class="headerRow"><div class="leftHead"></div><div class="timebar"><div class="ticks">$ticks</div></div></div>
      <div class="leftDivider"></div>
      <div class="body" id="body">$rows</div>
      <div class="footerRow"><div class="leftHead"></div><div class="timebar"><div class="ticks">$ticks</div></div></div>
    </div>
  </div>
</div>

<div id="tip"></div>
<div class="legend" id="legend">
  <div class="lg">
    <div class="row"><span class="sw" style="background:#95a5a6;border-color:#7f8c8d"></span> Other (non‚ÄëOBF)</div>
    <div class="row"><span class="sw" style="background:#e74c3c;border-color:#c0392b"></span> AMBIENT</div>
    <div class="row"><span class="sw" style="background:#2ecc71;border-color:#1e8449"></span> PRODUCE</div>
    <div class="row"><span class="sw" style="background:#5dade2;border-color:#2e86c1"></span> FRIDGE</div>
    <div class="row"><span class="sw" style="background:#2874A6;border-color:#1B4F72"></span> FREEZER</div>
    <div class="row"><span class="sw" style="background:#9b59b6;border-color:#7d3c98"></span> LARGE</div>
    <div class="row"><span class="sw" style="background:#e67e22;border-color:#af601a"></span> PRIORITY</div>
  </div>
  <button id="legBtn" class="legBtn" title="Toggle legend">‚ñæ</button>
</div>

<script>
(function(){
  const hs = document.getElementById('hs');
  // prevent outer scroll by sizing viewport to header
  const header = document.querySelector('.top');
  function setHdr(){ document.documentElement.style.setProperty('--hdr', header.offsetHeight + 'px'); }
  setHdr(); window.addEventListener('resize', setHdr, {passive:true});
  // theme toggle
  const THEME='pwa_theme';
  const body=document.body; const tbtn=document.getElementById('themeBtn');
  function setTheme(t){ body.classList.toggle('light', t==='light'); localStorage.setItem(THEME,t); tbtn.textContent = t==='light'?'üåô':'‚òÄÔ∏è'; }
  const saved=localStorage.getItem(THEME); setTheme(saved||'dark');
  tbtn.addEventListener('click',()=> setTheme(body.classList.contains('light')?'dark':'light'));
  // zoom
  const baseWidth = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--timeline-w'));
  const zr=document.getElementById('zoomRange');
  function applyScale(s){ const w=Math.round(baseWidth*s); document.documentElement.style.setProperty('--timeline-w', w+'px'); updateLabels(); }
  function setScale(s){ s=Math.min(3,Math.max(0.5,s)); zr.value=s; applyScale(s); }
  document.getElementById('zoomIn').addEventListener('click',()=>setScale(parseFloat(zr.value)+0.1));
  document.getElementById('zoomOut').addEventListener('click',()=>setScale(parseFloat(zr.value)-0.1));
  zr.addEventListener('input',e=>setScale(parseFloat(e.target.value)));
  setScale(0.5);

  // sorting (client-side)
  const bodyEl = document.getElementById('body');
  function sortBy(mode){
    const items = Array.from(bodyEl.children).map(row=>({
      row,
      name: row.getAttribute('data-emp')||'',
      start: parseFloat(row.getAttribute('data-start')||'Infinity'),
      uph: parseFloat(row.getAttribute('data-uph')||'-1'),
      runs: parseInt(row.getAttribute('data-runs')||'0',10)
    }));
    items.sort((a,b)=>{
      if(mode==='name') return a.name.localeCompare(b.name);
      if(mode==='uph') return (isNaN(b.uph)?-Infinity:b.uph) - (isNaN(a.uph)?-Infinity:a.uph);
      if(mode==='runs') return b.runs - a.runs;
      return a.start - b.start; // default start
    });
    items.forEach(it=> bodyEl.appendChild(it.row));
  }
  const sortSel = document.getElementById('sortSelect');
  sortSel.addEventListener('change', ()=> sortBy(sortSel.value));
  sortBy('start');
  const tip=document.getElementById('tip');
  const legend=document.getElementById('legend'); const legBtn=document.getElementById('legBtn');
  const LKEY='legend_min'; function setLegend(min){ if(min){ legend.classList.add('min'); legBtn.textContent='‚ñ¥'; } else { legend.classList.remove('min'); legBtn.textContent='‚ñæ'; } localStorage.setItem(LKEY, min?'1':'0'); }
  const ls=localStorage.getItem(LKEY); if(ls==='1') setLegend(true);
  legBtn.addEventListener('click', e=>{ e.stopPropagation(); setLegend(!legend.classList.contains('min')); });
  function showTip(el, html){ tip.innerHTML=html; tip.style.display='block'; const r=el.getBoundingClientRect(); const pad=8; let top=r.top - tip.offsetHeight - pad; let cls='above'; if(top < 4) { top=r.bottom + pad; cls='below'; } let left=r.left + 8; if(left+tip.offsetWidth>window.innerWidth-8) left=window.innerWidth-tip.offsetWidth-8; tip.className=''; tip.classList.add(cls); tip.style.top=top+'px'; tip.style.left=left+'px'; }
  function hideTip(){ tip.style.display='none'; }
  function maybeShowTip(e){ const b=e.target.closest('.bar'); if(b){ e.preventDefault(); showTip(b,b.dataset.tip); return true; } return false; }
  hs.addEventListener('pointerdown', e=>{ if(maybeShowTip(e)) e.stopPropagation(); }, {passive:false});
  hs.addEventListener('click', e=>{ if(maybeShowTip(e)) e.stopPropagation(); }, {passive:false});
  hs.addEventListener('touchstart', e=>{ if(maybeShowTip(e)) e.stopPropagation(); }, {passive:false});
  document.addEventListener('click',e=>{ if(!e.target.closest('.bar')) hideTip(); }, {passive:true});
  hs.addEventListener('scroll',()=>hideTip(), {passive:true});
  function updateLabels(){ document.querySelectorAll('.bar').forEach(b=>{ const w=b.getBoundingClientRect().width; const t=b.querySelector('.bar-text'); if(!t) return; if(w>=50) t.innerHTML=b.dataset.lfull; else if(w>=14) t.innerHTML=b.dataset.lshort; else t.innerHTML=''; }); }
  window.addEventListener('resize',updateLabels,{passive:true}); updateLabels();
})();
</script>
</body>
</html>
